From 5688208d93557eb5eaeda8c41a759e33d902eb5e Mon Sep 17 00:00:00 2001
From: Zoltan Varga <vargaz@gmail.com>
Date: Fri, 17 Jun 2022 20:46:33 -0400
Subject: [PATCH] [mono][aot] Avoid inflating methods with instantiations with
 a wrong argument count when using profiled AOT.

Fixes https://github.com/dotnet/runtime/issues/70773.
---
 src/mono/mono/mini/aot-compiler.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/mono/mono/mini/aot-compiler.c b/src/mono/mono/mini/aot-compiler.c
index fac7efd0fa3fe..904d76cfffb70 100644
--- a/src/mono/mono/mini/aot-compiler.c
+++ b/src/mono/mono/mini/aot-compiler.c
@@ -13063,6 +13063,9 @@ resolve_profile_data (MonoAotCompile *acfg, ProfileData *data, MonoAssembly* cur
 				if (mdata->inst->inst) {
 					MonoGenericContext ctx;
 
+					if (m->is_generic && mono_method_get_generic_container (m)->context.method_inst->type_argc != mdata->inst->inst->type_argc)
+						continue;
+
 					memset (&ctx, 0, sizeof (ctx));
 					ctx.method_inst = mdata->inst->inst;
 
