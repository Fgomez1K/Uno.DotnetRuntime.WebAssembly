From 138e125efa0b393f1077e7c2fbdb98bdd2cba8e6 Mon Sep 17 00:00:00 2001
From: Jerome Laban <jerome.laban@nventive.com>
Date: Fri, 9 Apr 2021 20:06:13 +0000
Subject: [PATCH] add support for AOT exception tracing

---
 src/mono/mono/mini/llvm-runtime.cpp | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/mono/mono/mini/llvm-runtime.cpp b/src/mono/mono/mini/llvm-runtime.cpp
index 9982cccfb0f..e63b260be8f 100644
--- a/src/mono/mono/mini/llvm-runtime.cpp
+++ b/src/mono/mono/mini/llvm-runtime.cpp
@@ -1,15 +1,20 @@
 #include <config.h>
+#include <stdio.h>
 #include "llvm-runtime.h"
 
 #include <glib.h>
 
 extern "C" {
 
+G_EXTERN_C
+gboolean mono_trace_is_enabled (void);
+
 void
 mono_llvm_cpp_throw_exception (void)
 {
 	gint32 *ex = NULL;
-
+	if (mono_trace_is_enabled ())
+		fprintf (stderr, "Native Stacktrace (mono_llvm_cpp_throw_exception)\n"); 
 	/* The generated code catches an int32* */
 	throw ex;
 }
@@ -25,4 +30,4 @@ mono_llvm_cpp_catch_exception (MonoLLVMInvokeCallback cb, gpointer arg, gboolean
 	}
 }
 
-}
+}
\ No newline at end of file
-- 
2.17.1

